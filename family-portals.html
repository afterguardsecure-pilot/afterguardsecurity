<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AfterGuard ‚Äî Family Portals</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;1,300;1,400&family=DM+Mono:wght@300;400&display=swap" rel="stylesheet">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
(async()=>{
  const {createClient} = supabase;
  const sb = createClient('https://bzscltliqeijqskcdajp.supabase.co','sb_publishable_LFfDCNnaH2PDo0auIBn9oA_td5dL5bD');
  const {data:{session}} = await sb.auth.getSession();
  if(!session){ window.location.replace('afterguard-auth.html'); return; }
  window._sb = sb; window._user = session.user;
  document.addEventListener('DOMContentLoaded',()=>{
    const m = session.user.user_metadata||{};
    const fn = m.first_name||''; const ln = m.last_name||'';
    const full = (fn+' '+ln).trim()||session.user.email;
    const ini = ((fn[0]||'')+(ln[0]||'')).toUpperCase()||session.user.email[0].toUpperCase();
    const role = m.account_type ? m.account_type.charAt(0).toUpperCase()+m.account_type.slice(1) : 'Member';
    document.querySelectorAll('.user-name').forEach(e=>e.textContent=full);
    document.querySelectorAll('.user-role').forEach(e=>e.textContent=role);
    document.querySelectorAll('.user-avatar').forEach(e=>e.textContent=ini);
  });
})();
async function handleSignOut(){
  if(window._sb) await window._sb.auth.signOut();
  window.location.replace('afterguard-auth.html');
}
</script>

<style>
  :root {
    --slate-950: #0a0c0f; --slate-900: #0f1318; --slate-800: #171d26;
    --slate-700: #1f2937; --slate-600: #374151; --slate-400: #9ca3af;
    --slate-300: #d1d5db; --slate-200: #e5e7eb;
    --gold-400: #d4a853; --gold-300: #e2bb72; --gold-200: #f0d4a0; --gold-500: #b8922e;
    --sage: #7a9e8e; --sage-light: #a3c4b5;
    --danger: #c0392b; --warn: #d97706; --ok: #2d6a4f;
  }
  * { margin:0; padding:0; box-sizing:border-box; }
  body { background:var(--slate-950); color:var(--slate-300); font-family:'Cormorant Garamond',Georgia,serif; min-height:100vh; overflow-x:hidden; }

  /* SIDEBAR */
  .sidebar { position:fixed; left:0; top:0; bottom:0; width:240px; background:var(--slate-900); border-right:1px solid rgba(212,168,83,0.12); display:flex; flex-direction:column; z-index:100; }
  .logo { padding:28px 24px 24px; border-bottom:1px solid rgba(212,168,83,0.1); }
  .logo-mark { display:flex; align-items:center; gap:12px; margin-bottom:6px; }
  .logo-shield { width:32px; height:32px; background:rgba(212,168,83,0.1); border:1px solid rgba(212,168,83,0.25); border-radius:6px; display:flex; align-items:center; justify-content:center; font-size:14px; flex-shrink:0; }
  .logo-name { font-size:16px; font-weight:300; letter-spacing:0.12em; color:var(--gold-300); font-family:'Cormorant Garamond',serif; }
  .logo-tagline { font-size:10px; letter-spacing:0.2em; color:var(--slate-400); font-family:'DM Mono',monospace; text-transform:uppercase; margin-left:44px; }
  .nav { flex:1; padding:20px 0; overflow-y:auto; }
  .nav-section { margin-bottom:28px; }
  .nav-section-label { font-family:'DM Mono',monospace; font-size:9px; letter-spacing:0.25em; text-transform:uppercase; color:var(--slate-600); padding:0 24px; margin-bottom:8px; }
  .nav-item { display:flex; align-items:center; gap:12px; padding:10px 24px; cursor:pointer; transition:all 0.2s; font-size:15px; font-weight:400; color:var(--slate-400); border-left:2px solid transparent; text-decoration:none; }
  .nav-item:hover { color:var(--slate-200); background:rgba(212,168,83,0.04); }
  .nav-item.active { color:var(--gold-300); border-left-color:var(--gold-400); background:rgba(212,168,83,0.06); }
  .nav-icon { font-size:15px; width:18px; text-align:center; flex-shrink:0; opacity:0.7; }
  .nav-item.active .nav-icon { opacity:1; }
  .badge { margin-left:auto; font-family:'DM Mono',monospace; font-size:10px; padding:2px 7px; border-radius:99px; background:rgba(192,57,43,0.2); color:#e57373; border:1px solid rgba(192,57,43,0.3); }
  .badge.warn { background:rgba(217,119,6,0.2); color:#fbbf24; border-color:rgba(217,119,6,0.3); }
  .badge.ok { background:rgba(45,106,79,0.2); color:var(--sage-light); border-color:rgba(45,106,79,0.3); }
  .sidebar-footer { padding:16px 24px; border-top:1px solid rgba(212,168,83,0.08); }
  .user-card { display:flex; align-items:center; gap:10px; }
  .user-avatar { width:34px; height:34px; border-radius:50%; background:linear-gradient(135deg,var(--gold-500),var(--sage)); display:flex; align-items:center; justify-content:center; font-size:13px; color:var(--slate-900); font-weight:600; flex-shrink:0; }
  .user-info { flex:1; min-width:0; }
  .user-name { font-size:14px; color:var(--slate-200); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
  .user-role { font-size:10px; font-family:'DM Mono',monospace; color:var(--slate-400); letter-spacing:0.1em; text-transform:uppercase; }
  .signout-btn { margin-top:10px; width:100%; background:transparent; border:1px solid rgba(212,168,83,0.12); border-radius:3px; color:var(--slate-400); font-family:'DM Mono',monospace; font-size:10px; letter-spacing:0.12em; text-transform:uppercase; padding:7px; cursor:pointer; transition:all 0.2s; display:flex; align-items:center; justify-content:center; gap:6px; }
  .signout-btn:hover { border-color:rgba(212,168,83,0.3); color:var(--gold-300); }

  /* MAIN */
  .main { margin-left:240px; min-height:100vh; display:flex; flex-direction:column; }
  .topbar { display:flex; align-items:center; justify-content:space-between; padding:20px 36px; border-bottom:1px solid rgba(212,168,83,0.08); background:var(--slate-950); position:sticky; top:0; z-index:50; backdrop-filter:blur(12px); }
  .page-eyebrow { font-family:'DM Mono',monospace; font-size:10px; letter-spacing:0.2em; text-transform:uppercase; color:var(--gold-400); margin-bottom:2px; }
  .page-title { font-size:26px; font-weight:300; color:var(--slate-200); font-family:'Cormorant Garamond',serif; letter-spacing:0.02em; }
  .topbar-actions { display:flex; align-items:center; gap:12px; }
  .content { padding:32px 36px; flex:1; }

  /* PANELS */
  .panel { background:var(--slate-900); border:1px solid rgba(212,168,83,0.1); border-radius:6px; margin-bottom:20px; }
  .panel-header { display:flex; align-items:center; justify-content:space-between; padding:18px 22px; border-bottom:1px solid rgba(212,168,83,0.08); }
  .panel-title { font-size:16px; font-weight:400; color:var(--slate-200); }
  .panel-eyebrow { font-family:'DM Mono',monospace; font-size:9px; letter-spacing:0.18em; text-transform:uppercase; color:var(--gold-400); margin-bottom:3px; }
  .panel-body { padding:22px; }

  /* GRID LAYOUTS */
  .grid-2 { display:grid; grid-template-columns:1fr 1fr; gap:20px; }
  .grid-3 { display:grid; grid-template-columns:repeat(3,1fr); gap:20px; }
  .grid-4 { display:grid; grid-template-columns:repeat(4,1fr); gap:16px; }

  /* STAT CARDS */
  .stat-card { background:var(--slate-900); border:1px solid rgba(212,168,83,0.1); border-radius:6px; padding:20px 22px; }
  .stat-val { font-family:'Cormorant Garamond',serif; font-size:2.4rem; font-weight:300; color:var(--slate-200); line-height:1; margin-bottom:4px; }
  .stat-label { font-family:'DM Mono',monospace; font-size:9px; letter-spacing:0.15em; text-transform:uppercase; color:var(--slate-600); }
  .stat-delta { font-family:'DM Mono',monospace; font-size:10px; margin-top:6px; }
  .stat-delta.up { color:var(--sage-light); }
  .stat-delta.down { color:#e57373; }

  /* TABLE */
  .tbl { width:100%; border-collapse:collapse; }
  .tbl th { font-family:'DM Mono',monospace; font-size:9px; letter-spacing:0.18em; text-transform:uppercase; color:var(--slate-600); padding:10px 14px; text-align:left; border-bottom:1px solid rgba(212,168,83,0.08); }
  .tbl td { padding:12px 14px; font-size:14px; border-bottom:1px solid rgba(255,255,255,0.03); vertical-align:middle; }
  .tbl tr:last-child td { border-bottom:none; }
  .tbl tr:hover td { background:rgba(212,168,83,0.02); }

  /* BUTTONS */
  .btn { display:inline-flex; align-items:center; gap:8px; padding:8px 18px; border-radius:4px; font-family:'DM Mono',monospace; font-size:11px; letter-spacing:0.08em; cursor:pointer; transition:all 0.2s; border:none; text-decoration:none; }
  .btn-ghost { background:transparent; color:var(--slate-400); border:1px solid var(--slate-700); }
  .btn-ghost:hover { color:var(--slate-200); border-color:var(--slate-500); }
  .btn-gold { background:rgba(212,168,83,0.12); border:1px solid rgba(212,168,83,0.3); color:var(--gold-300); }
  .btn-gold:hover { background:rgba(212,168,83,0.2); }
  .btn-danger { background:rgba(192,57,43,0.15); border:1px solid rgba(192,57,43,0.3); color:#ef9a9a; }
  .btn-danger:hover { background:rgba(192,57,43,0.25); }

  /* BADGES */
  .tag { display:inline-flex; align-items:center; gap:5px; font-family:'DM Mono',monospace; font-size:10px; padding:3px 9px; border-radius:99px; }
  .tag-red { background:rgba(192,57,43,0.15); color:#ef9a9a; border:1px solid rgba(192,57,43,0.25); }
  .tag-yellow { background:rgba(217,119,6,0.15); color:#fbbf24; border:1px solid rgba(217,119,6,0.25); }
  .tag-green { background:rgba(45,106,79,0.15); color:var(--sage-light); border:1px solid rgba(45,106,79,0.25); }
  .tag-blue { background:rgba(59,130,246,0.12); color:#93c5fd; border:1px solid rgba(59,130,246,0.2); }
  .tag-gold { background:rgba(212,168,83,0.1); color:var(--gold-300); border:1px solid rgba(212,168,83,0.2); }

  /* FILE UPLOAD */
  .upload-zone { border:1px dashed rgba(212,168,83,0.25); border-radius:6px; padding:32px 20px; text-align:center; cursor:pointer; transition:all 0.2s; background:rgba(212,168,83,0.02); }
  .upload-zone:hover { border-color:rgba(212,168,83,0.45); background:rgba(212,168,83,0.05); }
  .upload-zone.dragover { border-color:var(--gold-300); background:rgba(212,168,83,0.08); }
  .upload-icon { font-size:28px; margin-bottom:10px; opacity:0.6; }
  .upload-label { font-family:'DM Mono',monospace; font-size:10px; letter-spacing:0.12em; text-transform:uppercase; color:var(--slate-400); margin-bottom:6px; }
  .upload-sub { font-size:12px; color:var(--slate-600); }
  .upload-list { margin-top:14px; }
  .upload-item { display:flex; align-items:center; gap:10px; padding:8px 12px; background:var(--slate-800); border-radius:4px; margin-bottom:6px; font-size:13px; }
  .upload-item-name { flex:1; color:var(--slate-300); font-size:13px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
  .upload-item-size { font-family:'DM Mono',monospace; font-size:10px; color:var(--slate-600); }
  .upload-item-remove { background:none; border:none; cursor:pointer; color:var(--slate-600); font-size:14px; transition:color 0.2s; padding:0 2px; }
  .upload-item-remove:hover { color:#ef9a9a; }

  /* FORM */
  .field-group { margin-bottom:16px; }
  .field-label { font-family:'DM Mono',monospace; font-size:9px; letter-spacing:0.15em; text-transform:uppercase; color:var(--slate-400); margin-bottom:7px; display:block; }
  .field-input { width:100%; padding:10px 14px; background:var(--slate-800); border:1px solid rgba(212,168,83,0.1); border-radius:3px; color:var(--slate-200); font-family:'DM Mono',monospace; font-size:12px; outline:none; transition:border-color 0.2s; }
  .field-input:focus { border-color:rgba(212,168,83,0.35); }
  .field-input::placeholder { color:var(--slate-600); }
  select.field-input option { background:var(--slate-800); }

  /* EMPTY STATE */
  .empty-state { text-align:center; padding:48px 20px; color:var(--slate-600); }
  .empty-icon { font-size:32px; margin-bottom:12px; opacity:0.4; }
  .empty-text { font-family:'DM Mono',monospace; font-size:10px; letter-spacing:0.12em; text-transform:uppercase; }

  /* DOT INDICATORS */
  .live-dot { width:7px; height:7px; border-radius:50%; background:#e57373; display:inline-block; animation:blink 1.5s ease-in-out infinite; }
  .live-dot.ok { background:var(--sage-light); box-shadow:0 0 5px var(--sage-light); animation:none; }
  .live-dot.warn { background:#fbbf24; }
  @keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.3} }

  @media(max-width:900px){.sidebar{display:none}.main{margin-left:0}}
</style>
</head>
<body>

<div class="sidebar">
  <div class="logo">
    <div class="logo-mark">
      <div class="logo-shield">üõ°</div>
      <span class="logo-name">AfterGuard</span>
    </div>
    <div class="logo-tagline">Secure Portal</div>
  </div>
  <nav class="nav"><div class="nav-section-label">Monitor</div><a href="vigil-security.html" class="nav-item "><span class="nav-icon">üè†</span>Overview</a><div class="nav-section-label">Security</div><a href="alerts.html" class="nav-item "><span class="nav-icon">üîî</span>Alerts<span class="badge">3</span></a><a href="threats.html" class="nav-item "><span class="nav-icon">‚ö°</span>Threats<span class="badge">2</span></a><a href="threat-intel.html" class="nav-item "><span class="nav-icon">üîç</span>Threat Intel</a><div class="nav-section-label">Access</div><a href="access-control.html" class="nav-item "><span class="nav-icon">üîê</span>Access Control</a><div class="nav-section-label">Records</div><a href="estate-records.html" class="nav-item "><span class="nav-icon">üìÇ</span>Estate Records</a><a href="family-portals.html" class="nav-item active"><span class="nav-icon">üë®‚Äçüë©‚Äçüëß</span>Family Portals</a><div class="nav-section-label">Compliance</div><a href="audit-log.html" class="nav-item "><span class="nav-icon">üìã</span>Audit Log</a><a href="staff-roles.html" class="nav-item "><span class="nav-icon">üë•</span>Staff & Roles</a></nav>
  <div class="sidebar-footer">
    <div class="user-card">
      <div class="user-avatar">?</div>
      <div class="user-info">
        <div class="user-name">Loading‚Ä¶</div>
        <div class="user-role">Member</div>
      </div>
    </div>
    <button class="signout-btn" onclick="handleSignOut()">‚Üí Sign Out</button>
  </div>
</div>
<div class="main">
  <div class="topbar">
    <div>
      <div class="page-eyebrow">Records ¬∑ Bereaved Family Access</div>
      <div class="page-title">Family Portals</div>
    </div>
    <div class="topbar-actions">
      <span class="live-dot"></span>
      <span style="font-family:'DM Mono',monospace;font-size:10px;color:var(--slate-600);letter-spacing:0.1em;">LIVE</span>
    </div>
  </div>
  <div class="content">

<div class="grid-4" style="margin-bottom:20px">
  <div class="stat-card"><div class="stat-val">47</div><div class="stat-label">Active Portals</div><div class="stat-delta up">Families connected</div></div>
  <div class="stat-card"><div class="stat-val">138</div><div class="stat-label">Family Members</div><div class="stat-delta up">With secure access</div></div>
  <div class="stat-card"><div class="stat-val">12</div><div class="stat-label">Pending Invites</div><div class="stat-delta up">Awaiting acceptance</div></div>
  <div class="stat-card"><div class="stat-val">0</div><div class="stat-label">Unauthorized Access</div><div class="stat-delta up">‚úì Clean</div></div>
</div>

<div class="panel">
  <div class="panel-header">
    <div><div class="panel-eyebrow">Family Access</div><div class="panel-title">Active Family Portals</div></div>
    <button class="btn btn-gold">+ Create Portal</button>
  </div>
  <div class="panel-body" style="padding:0">
    <table class="tbl">
      <thead><tr><th>Portal ID</th><th>Estate</th><th>Primary Contact</th><th>Members</th><th>Last Access</th><th>Status</th><th>Action</th></tr></thead>
      <tbody>
        <tr><td><span style="font-family:'DM Mono',monospace;font-size:11px;color:var(--gold-400)">#FP-0871</span></td><td>R. Whitmore Estate</td><td>Margaret Whitmore</td><td>3</td><td>Today 09:42</td><td><span class="tag tag-green">Active</span></td><td><button class="btn btn-ghost" style="padding:4px 10px;font-size:10px">Manage</button></td></tr>
        <tr><td><span style="font-family:'DM Mono',monospace;font-size:11px;color:var(--gold-400)">#FP-0821</span></td><td>E. Nash Estate</td><td>James Nash</td><td>2</td><td>Yesterday</td><td><span class="tag tag-green">Active</span></td><td><button class="btn btn-ghost" style="padding:4px 10px;font-size:10px">Manage</button></td></tr>
        <tr><td><span style="font-family:'DM Mono',monospace;font-size:11px;color:var(--gold-400)">#FP-0744</span></td><td>H. Chen Estate</td><td>Lisa Chen</td><td>5</td><td>Feb 23</td><td><span class="tag tag-green">Active</span></td><td><button class="btn btn-ghost" style="padding:4px 10px;font-size:10px">Manage</button></td></tr>
        <tr><td><span style="font-family:'DM Mono',monospace;font-size:11px;color:var(--gold-400)">#FP-0699</span></td><td>D. Park Estate</td><td>‚Äî</td><td>0</td><td>Never</td><td><span class="tag tag-yellow">Pending</span></td><td><button class="btn btn-ghost" style="padding:4px 10px;font-size:10px">Send Invite</button></td></tr>
      </tbody>
    </table>
  </div>
</div>

<div class="grid-2" style="margin-top:20px">
  <div class="panel">
    <div class="panel-header"><div class="panel-title">Invite Family Member</div></div>
    <div class="panel-body">
      <div class="field-group"><label class="field-label">Full Name</label><input class="field-input" placeholder="e.g. Margaret Whitmore"></div>
      <div class="field-group"><label class="field-label">Email Address</label><input class="field-input" placeholder="family@example.com"></div>
      <div class="field-group"><label class="field-label">Portal / Estate ID</label><input class="field-input" placeholder="e.g. FP-0871"></div>
      <div class="field-group"><label class="field-label">Relationship to Deceased</label><select class="field-input"><option>Spouse</option><option>Child</option><option>Parent</option><option>Sibling</option><option>Executor</option><option>Attorney</option><option>Other</option></select></div>
      <button class="btn btn-gold" style="width:100%;justify-content:center;padding:10px">Send Secure Invite</button>
    </div>
  </div>
  <div class="panel">
    <div class="panel-header"><div class="panel-title">Upload Family Documents</div></div>
    <div class="panel-body">
      <div class="field-group"><label class="field-label">Portal ID</label><input class="field-input" placeholder="e.g. FP-0871"></div>
      <div class="upload-zone" id="family-zone"><div class="upload-icon">üë®‚Äçüë©‚Äçüëß</div><div class="upload-label">Drop documents for family portal</div><div class="upload-sub">ID verification, relationship proof, legal docs</div></div>
      <input type="file" id="family-input" multiple style="display:none">
      <div class="upload-list" id="family-list"></div>
    </div>
  </div>
</div>

  </div>
</div>

<script>
function initUpload(zoneId, inputId, listId) {
  const zone = document.getElementById(zoneId);
  const input = document.getElementById(inputId);
  const list = document.getElementById(listId);
  if(!zone||!input) return;
  zone.addEventListener('click', () => input.click());
  zone.addEventListener('dragover', e => { e.preventDefault(); zone.classList.add('dragover'); });
  zone.addEventListener('dragleave', () => zone.classList.remove('dragover'));
  zone.addEventListener('drop', e => { e.preventDefault(); zone.classList.remove('dragover'); handleFiles(e.dataTransfer.files, list); });
  input.addEventListener('change', () => handleFiles(input.files, list));
}
function handleFiles(files, list) {
  Array.from(files).forEach(f => {
    const item = document.createElement('div');
    item.className = 'upload-item';
    const size = f.size > 1024*1024 ? (f.size/1024/1024).toFixed(1)+' MB' : Math.round(f.size/1024)+' KB';
    item.innerHTML = `<span style="font-size:16px">üìÑ</span><span class="upload-item-name">${f.name}</span><span class="upload-item-size">${size}</span><button class="upload-item-remove" onclick="this.parentElement.remove()">‚úï</button>`;
    list.appendChild(item);
  });
}
</script>

<script>document.addEventListener('DOMContentLoaded',()=>initUpload('family-zone','family-input','family-list'));</script>
</body>
</html>